name: Format Filenames

on:
  push:
    paths:
      - 'java/**/*'
      - '!*./md'

jobs:
  format:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
        with:
          ref: ${{ github.head_ref }}

      - name: Rename files in java folder using Bash
        run: |
          for file in java/*; do
            # Extract just the filename from the path
            filename=$(basename "$file")
            
            # Check if the file matches the desired pattern
            if [[ $filename =~ ^([0-9]+)\.\ (.*)$ ]]; then
              number=$(printf "%04d" ${BASH_REMATCH[1]})
              name=${BASH_REMATCH[2]}
              newFilename="${number}. ${name}.java"

              # Construct the new path
              newPath="java/$newFilename"

              if [[ "$file" != "$newPath" ]]; then
                echo "Renaming $file to $newPath" # Debug output
                mv "$file" "$newPath"
              fi
            fi
          done

      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add -A
          git commit -m "Format filenames in java folder" || echo "No changes to commit"
          git push
